@page
@using SmartCampus.Web.Pages.Shared
@model SmartCampus.Web.Pages.Homework.IndexModel
@{
    ViewData["Title"] = "Homework";
    var isTeacher = User.IsInRole("Teacher");
    var canCreate = User.IsInRole("Admin") || User.IsInRole("Teacher");

    var pageHeader = new PageHeaderModel
    {
        Title = "Homework & Assignments",
        Subtitle = isTeacher ? "Manage your homework assignments and track submissions" : "Track and submit your homework",
        IconClass = "fas fa-tasks",
        IconColor = "#ff9500",
        GradientStart = "rgba(255, 149, 0, 0.05)",
        GradientEnd = "rgba(52, 199, 89, 0.05)",
        BorderColor = "rgba(255, 149, 0, 0.1)",
        Actions = canCreate ? new()
        {
            new PageHeaderAction
            {
                Label = "New Homework",
                Url = Url.Page("Create"),
                CssClass = "btn-warning",
                IconClass = "fas fa-plus"
            }
        } : new()
    };
}

<partial name="_PageHeader" model="pageHeader" />


<div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; align-items: center;">
    <div style="flex: 1; min-width: 200px;">
        <form method="get" class="d-flex gap-2">
            <div style="flex: 1;">
                <input type="text" name="searchTerm" placeholder="Search homework..." class="form-control" 
                       value="@Model.SearchTerm"
                       style="border: 2px solid #e5e5ea; border-radius: 10px; padding: 10px 14px; font-size: 0.95rem;" />
            </div>
            <button type="submit" class="btn" style="border-radius: 10px; padding: 10px 18px; background: #ff9500; color: white; border: none; font-weight: 500;">
                <i class="fas fa-search"></i>
            </button>
        </form>
    </div>
</div>


@if (Model.Homeworks != null && Model.Homeworks.Count > 0)
{
    <div style="display: grid; gap: 24px; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));">
        @foreach (var homework in Model.Homeworks.OrderBy(h => h.DueDate))
        {
            var isOverdue = homework.DueDate < DateTime.Now;
            var isDueSoon = homework.DueDate <= DateTime.Now.AddDays(7) && !isOverdue;
            var statusColor = isOverdue ? "#ff3b30" : isDueSoon ? "#0066ff" : "#34c759";
            var gradientStart = isOverdue ? "#ff3b30" : isDueSoon ? "#0066ff" : "#34c759";
            var gradientEnd = isOverdue ? "#ff6b63" : isDueSoon ? "#4d94ff" : "#5dd98f";
            var statusIcon = isOverdue ? "fa-exclamation-circle" : isDueSoon ? "fa-clock" : homework.IsCompleted ? "fa-check-circle" : "fa-calendar";
            var statusLabel = isOverdue ? "Overdue" : isDueSoon ? "Due Soon" : homework.IsCompleted ? "Completed" : "Upcoming";

            <div class="card" style="border: none; overflow: hidden; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); border-radius: 16px; display: flex; flex-direction: column; height: 100%;">
                
                <div style="background: linear-gradient(135deg, @gradientStart 0%, @gradientEnd 100%); color: white; padding: 24px 20px; position: relative; overflow: hidden;">
                    
                    <div style="position: absolute; top: -40px; right: -40px; width: 140px; height: 140px; background: rgba(255, 255, 255, 0.15); border-radius: 50%;"></div>
                    
                    <div style="position: relative; z-index: 1;">
                        
                        <span style="display: inline-block; background: rgba(255, 255, 255, 0.25); padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; font-weight: 600; margin-bottom: 12px; letter-spacing: 0.5px; text-transform: uppercase;">
                            <i class="fas fa-layer-group me-1" style="opacity: 0.9;"></i>@homework.CourseName
                        </span>

                        
                        <h4 style="font-size: 1.35rem; font-weight: 800; margin: 0 0 2px 0; color: white; word-break: break-word;">
                            @homework.Title
                        </h4>

                        
                        <div style="margin-top: 12px; display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 0.85rem; font-weight: 600; opacity: 0.95;">
                                <i class="fas @statusIcon me-1"></i>@statusLabel
                            </span>
                            <span style="font-size: 0.9rem; font-weight: 700;">
                                @homework.DueDate.ToString("MMM dd")
                            </span>
                        </div>
                    </div>
                </div>

                
                <div class="card-body" style="padding: 20px; flex-grow: 1; display: flex; flex-direction: column;">
                    
                    @if (!string.IsNullOrEmpty(homework.Description))
                    {
                        <p style="color: #636366; font-size: 0.9rem; margin-bottom: 16px; line-height: 1.6; flex-grow: 1;">
                            @Html.Raw(homework.Description.Length > 100 ? homework.Description.Substring(0, 100) + "..." : homework.Description)
                        </p>
                    }
                    else
                    {
                        <p style="color: #a1a1a6; font-size: 0.9rem; margin-bottom: 16px; line-height: 1.6; flex-grow: 1; font-style: italic;">
                            No description provided
                        </p>
                    }

                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; padding-top: 12px; border-top: 1px solid #e5e5ea;">
                        
                        <div style="display: flex; flex-direction: column;">
                            <span style="font-size: 0.75rem; color: #a1a1a6; font-weight: 600; text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 4px;">
                                <i class="fas fa-calendar-alt me-1" style="color: #ff9500;"></i>Due Date
                            </span>
                            <span style="font-size: 0.95rem; color: #1d1d1f; font-weight: 600;">
                                @homework.DueDate.ToString("MMM dd, yyyy")
                            </span>
                        </div>

                        
                        @if (homework.Type != null)
                        {
                            <div style="display: flex; flex-direction: column;">
                                <span style="font-size: 0.75rem; color: #a1a1a6; font-weight: 600; text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 4px;">
                                    <i class="fas fa-tag me-1" style="color: #5e5ce6;"></i>Type
                                </span>
                                <span style="font-size: 0.95rem; color: #1d1d1f; font-weight: 600;">
                                    @homework.Type
                                </span>
                            </div>
                        }
                    </div>

                    
                    @if (homework.IsCompleted)
                    {
                        <div style="background: linear-gradient(135deg, #e8f5e9 0%, #f0fdf4 100%); border: 1.5px solid #34c759; padding: 10px 14px; border-radius: 10px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-check-circle" style="color: #34c759; font-size: 1.1rem;"></i>
                            <span style="font-size: 0.9rem; color: #2d5016; font-weight: 600;">Marked as completed</span>
                        </div>
                    }
                </div>

                
                <div style="background: #f9f9fb; border-top: 1px solid #e5e5ea; padding: 16px 20px; display: flex; gap: 10px; flex-wrap: wrap; border-radius: 0 0 16px 16px;">
                    <a asp-page="Details" asp-route-id="@homework.Id" 
                       class="btn btn-sm" 
                       style="flex: 1; min-width: 100px; background: linear-gradient(135deg, #5e5ce6 0%, #0066ff 100%); color: white; border: none; border-radius: 8px; padding: 10px 14px; font-weight: 600; text-decoration: none; text-align: center; transition: all 0.3s ease; cursor: pointer; box-shadow: 0 2px 8px rgba(94, 92, 230, 0.2);"
                       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(94, 92, 230, 0.3)';"
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(94, 92, 230, 0.2)';">
                        <i class="fas fa-arrow-right me-1"></i>View Details
                    </a>

                    @if (isTeacher)
                    {
                        <a asp-page="Edit" asp-route-id="@homework.Id" 
                           class="btn btn-sm" 
                           style="flex: 1; min-width: 100px; background: #e3f2fd; color: #0066ff; border: none; border-radius: 8px; padding: 10px 14px; font-weight: 600; text-decoration: none; text-align: center; transition: all 0.3s ease; cursor: pointer;"
                           onmouseover="this.style.background='#d1e7fd';"
                           onmouseout="this.style.background='#e3f2fd';">
                            <i class="fas fa-edit me-1"></i>Edit
                        </a>
                        <button type="button" 
                                class="btn btn-sm" 
                                style="flex: 1; min-width: 100px; background: #ffebee; color: #ff3b30; border: none; border-radius: 8px; padding: 10px 14px; font-weight: 600; text-decoration: none; text-align: center; transition: all 0.3s ease; cursor: pointer;"
                                data-bs-toggle="modal" 
                                data-bs-target="#confirmModal" 
                                data-delete-url="@Url.Page("Index", new { handler = "Delete", id = homework.Id })" 
                                data-delete-entity="@homework.Id"
                                onmouseover="this.style.background='#ffcdd2';"
                                onmouseout="this.style.background='#ffebee';">
                            <i class="fas fa-trash me-1"></i>Delete
                        </button>
                    }
                </div>
            </div>
        }
    </div>
}
else
{
    <div style="background: linear-gradient(135deg, rgba(255, 149, 0, 0.05) 0%, rgba(255, 59, 48, 0.05) 100%); border: 1px solid rgba(255, 149, 0, 0.1); border-radius: 12px; padding: 40px; text-align: center;">
        <div style="font-size: 3rem; color: #ff9500; opacity: 0.3; margin-bottom: 16px;">
            <i class="fas fa-inbox"></i>
        </div>
        <h4 style="color: #1d1d1f; font-weight: 600; margin-bottom: 8px;">No Homework Found</h4>
        <p style="color: #636366; margin-bottom: 0;">@(isTeacher ? "You haven't created any homework yet." : "No homework homeworks available.")</p>
        @if (canCreate)
        {
            <a asp-page="Create" class="btn" style="margin-top: 15px; background: #ff9500; color: white; border: none; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 500;">
                <i class="fas fa-plus me-1"></i>Create First Homework
            </a>
        }
    </div>
}
