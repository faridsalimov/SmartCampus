@model SmartCampus.Web.ViewModels.StudentDashboardViewModel

@if (Model == null)
{
    <div style="padding: 40px 20px; text-align: center; color: #8e8e93;">
        <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 16px;"></i>
        <p>Unable to load student dashboard. Please refresh the page or contact support.</p>
    </div>
    return;
}

<div class="status-cards-grid">
    <div class="status-card card-pending fade-in" style="--delay: 0.1s;">
        <div class="status-icon">
            <i class="fas fa-list-check"></i>
        </div>
        <div class="status-info">
            <div class="status-number">@Model.PendingHomeworkCount</div>
            <div class="status-label">Pending Tasks</div>
        </div>
        <div class="status-glow"></div>
    </div>

    <div class="status-card card-overdue fade-in" style="--delay: 0.2s;">
        <div class="status-icon">
            <i class="fas fa-exclamation"></i>
        </div>
        <div class="status-info">
            <div class="status-number">@Model.OverdueHomeworkCount</div>
            <div class="status-label">Overdue Tasks</div>
        </div>
        <div class="status-glow"></div>
    </div>
</div>


<div class="student-dashboard-grid">
    
    <div class="dashboard-left">
        
        <div class="dashboard-card slide-up" style="--delay: 0.1s;">
            <div class="card-header">
                <div class="header-icon-group">
                    <i class="fas fa-calendar"></i>
                    <h3>Weekly Schedule</h3>
                </div>
                <div class="header-action">
                    <a href="/Schedule" class="view-more-link">View Full Schedule</a>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                @if (Model.UpcomingLessons != null && Model.UpcomingLessons.Any())
                {
                    foreach (var dayGroup in Model.UpcomingLessons.GroupBy(x => x.LessonDate.Date.DayOfWeek).OrderBy(x => x.Key))
                    {
                        <div style="border-bottom: 1px solid #e5e5ea; padding: 20px;">
                            <h5 style="margin: 0 0 16px 0; font-weight: 700; color: #1d1d1f; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-calendar-day" style="color: #5e5ce6;"></i>
                                @dayGroup.Key.ToString()
                            </h5>
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                @foreach (var lesson in dayGroup.OrderBy(x => x.LessonDate.TimeOfDay).Take(5))
                                {
                                    <div style="background: linear-gradient(135deg, #f5f5f7 0%, #efefef 100%); padding: 16px; border-radius: 10px; border-left: 5px solid #5e5ce6; display: flex; gap: 16px; align-items: flex-start;">
                                        <div style="min-width: 65px; display: flex; flex-direction: column; align-items: flex-start;">
                                            <div style="font-weight: 700; color: #5e5ce6; font-size: 1.1rem;">@lesson.LessonDate.ToString("HH:mm")</div>
                                            <small style="color: #a1a1a6; font-size: 0.75rem;">@lesson.LessonDate.ToString("MMM dd")</small>
                                        </div>
                                        <div style="flex: 1; min-width: 0;">
                                            <div style="font-weight: 700; color: #1d1d1f; margin-bottom: 6px; font-size: 0.95rem;">@lesson.Title</div>
                                            <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #636366; margin-bottom: 4px;">
                                                <i class="fas fa-book" style="color: #5e5ce6; flex-shrink: 0;"></i>
                                                <span>@lesson.CourseName</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 6px; font-size: 0.8rem; color: #a1a1a6;">
                                                <i class="fas fa-map-pin" style="color: #5e5ce6; flex-shrink: 0;"></i>
                                                <span>@lesson.Location</span>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div style="padding: 40px 24px; text-align: center; color: #8e8e93;">
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: #f5f5f7; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                            <i class="fas fa-calendar-times" style="font-size: 2rem; color: #ccc;"></i>
                        </div>
                        <p style="margin: 0; font-weight: 600;">No upcoming lessons</p>
                    </div>
                }
            </div>
        </div>

        
        <div class="dashboard-card slide-up" style="--delay: 0.2s;">
            <div class="card-header">
                <div class="header-icon-group">
                    <i class="fas fa-star"></i>
                    <h3>Recent Grades</h3>
                </div>
                <div class="header-action">
                    <a href="/Grades" class="view-more-link">View All</a>
                </div>
            </div>
            <div class="card-body">
                @if (Model.RecentGrades != null && Model.RecentGrades.Any())
                {
                    <div class="grades-stack">
                        @foreach (var grade in Model.RecentGrades.Take(4))
                        {
                            <div class="grade-item-modern fade-in-item" style="--item-delay: 0.1s;">
                                <div class="grade-icon-wrapper">
                                    <i class="fas fa-certificate"></i>
                                </div>
                                <div class="grade-info">
                                    <div class="grade-course">@grade.CourseName</div>
                                    <div class="grade-date">@grade.GradedDate.ToString("MMM dd, yyyy")</div>
                                </div>
                                <div class="grade-badge" style="background: linear-gradient(135deg, rgba(94, 92, 230, 0.1), transparent); color: var(--primary);">
                                    <span class="grade-letter">@grade.LetterGrade</span>
                                    <span class="grade-score">@grade.Score.ToString("F0")</span>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-placeholder">No grades yet</div>
                }
            </div>
        </div>
    </div>

    
    <div class="dashboard-middle">
        
        <div class="dashboard-card slide-up" style="--delay: 0.15s;">
            <div class="card-header">
                <div class="header-icon-group">
                    <i class="fas fa-chart-pie"></i>
                    <h3>Attendance Summary</h3>
                </div>
            </div>
            <div class="card-body">
                @if (Model.AttendancePercentageLast30Days > 0)
                {
                    <div class="attendance-stats-grid">
                        <div class="stat-widget attendance-present">
                            <div class="stat-widget-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-widget-content">
                                <div class="stat-widget-label">Present</div>
                                <div class="stat-widget-value">@Model.TotalClassesAttendedLast30Days</div>
                            </div>
                        </div>
                        <div class="stat-widget attendance-absent">
                            <div class="stat-widget-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="stat-widget-content">
                                <div class="stat-widget-label">Absent</div>
                                <div class="stat-widget-value">@Model.TotalClassesMissedLast30Days</div>
                            </div>
                        </div>
                    </div>

                    <div class="attendance-bar-section">
                        <div class="attendance-label">
                            <span>Attendance Rate</span>
                            <span class="percentage-value">@Model.AttendancePercentageLast30Days.ToString("F0")%</span>
                        </div>
                        <div class="progress-bar-animated">
                            <div class="progress-fill" style="width: @Model.AttendancePercentageLast30Days%"></div>
                        </div>
                    </div>
                }
            </div>
        </div>

        
        <div class="dashboard-card slide-up" style="--delay: 0.25s;">
            <div class="card-header">
                <div class="header-icon-group">
                    <i class="fas fa-history"></i>
                    <h3>Recent Activity</h3>
                </div>
            </div>
            <div class="card-body activity-feed">
                @if (Model.RecentAttendance.Any())
                {
                    <div class="activity-timeline">
                        @foreach (var attendance in Model.RecentAttendance.Take(10))
                        {
                            var statusClass = attendance.Status == "Present" ? "present" : attendance.Status == "Late" ? "late" : "absent";
                            <div class="activity-entry fade-in-item">
                                <div class="activity-status-dot @statusClass"></div>
                                <div class="activity-text">
                                    <span class="activity-action">@(attendance.Status == "Present" ? "Attended class" : attendance.Status == "Late" ? "Attended (Late)" : "Absent")</span>
                                    <span class="activity-time">@attendance.Date.ToString("MMM dd, HH:mm")</span>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-placeholder">No attendance records</div>
                }
            </div>
        </div>
    </div }

    
    <div class="dashboard-right">
        
        <div class="dashboard-card slide-up" style="--delay: 0.2s;">
            <div class="card-header">
                <div class="header-icon-group">
                    <i class="fas fa-users"></i>
                    <h3>Group Members</h3>
                </div>
            </div>
            <div class="card-body">
                @if (Model.GroupOverview != null && Model.GroupOverview.Groupmates != null && Model.GroupOverview.Groupmates.Any())
                {
                    <div class="members-list">
                        @foreach (var mate in Model.GroupOverview.Groupmates.Take(6))
                        {
                            <div class="member-card fade-in-item">
                                <img src="https://ui-avatars.com/api/?name=@System.Net.WebUtility.UrlEncode(mate.FullName ?? "User")&background=random&color=fff"
                                     alt="@(mate.FullName ?? "Student")"
                                     class="member-avatar">
                                <div class="member-info">
                                    <div class="member-name">@(mate.FullName ?? "Unknown")</div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="empty-placeholder">No group members</div>
                }
            </div>
        </div>

        
        <div class="dashboard-card slide-up" style="--delay: 0.3s;">
            <div class="card-header">
                <div class="header-icon-group">
                    <i class="fas fa-bullhorn"></i>
                    <h3>Announcements</h3>
                </div>
            </div>
            <div class="card-body announcements-list">
                @if (Model.Announcements.Any())
                {
                    foreach (var ann in Model.Announcements.Take(4))
                    {
                        <div class="announcement-card fade-in-item">
                            <div class="announcement-data">
                                <div class="announcement-title">@ann.Title</div>
                                <div class="announcement-excerpt">@ann.Content</div>
                                <div class="announcement-footer">
                                    <span class="announcement-author">@ann.Author</span>
                                    <span class="announcement-date">@ann.PublishedDate.ToString("M/d")</span>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-placeholder">No announcements</div>
                }
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --primary: #5e5ce6;
        --success: #34c759;
        --warning: #ff9500;
        --danger: #ff3b30;
        --dark: #1c1c1e;
        --gray: #8e8e93;
        --border: #e5e5ea;
        --background: #f5f5f7;
    }

    @@keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(40px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @@keyframes fadeInItem {
        from {
            opacity: 0;
            transform: translateX(-10px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .fade-in {
        animation: fadeIn 0.6s ease-out forwards;
        opacity: 0;
        animation-delay: var(--delay, 0);
    }

    .slide-up {
        animation: slideUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        opacity: 0;
        animation-delay: var(--delay, 0);
    }

    .fade-in-item {
        animation: fadeInItem 0.5s ease-out forwards;
        opacity: 0;
        animation-delay: var(--item-delay, 0);
    }

    .status-cards-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 40px;
    }

    .status-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        display: flex;
        gap: 16px;
        align-items: center;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        border: 2px solid transparent;
    }

    .status-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    }

    .status-card.card-pending {
        border-color: rgba(124, 58, 237, 0.2);
    }

    .status-card.card-pending:hover {
        border-color: #7c3aed;
    }

    .status-card.card-overdue {
        border-color: rgba(255, 107, 74, 0.2);
    }

    .status-card.card-overdue:hover {
        border-color: #ff6b4a;
    }

    .status-glow {
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .status-card:hover .status-glow {
        opacity: 0.05;
    }

    .status-icon {
        width: 64px;
        height: 64px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        flex-shrink: 0;
    }

    .status-card.card-pending .status-icon {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(124, 58, 237, 0.05));
        color: #7c3aed;
    }

    .status-card.card-overdue .status-icon {
        background: linear-gradient(135deg, rgba(255, 107, 74, 0.15), rgba(255, 107, 74, 0.05));
        color: #ff6b4a;
    }

    .status-info {
        flex: 1;
    }

    .status-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--dark);
        line-height: 1;
        margin-bottom: 6px;
    }

    .status-label {
        color: var(--gray);
        font-size: 0.9rem;
        font-weight: 600;
    }

    .student-dashboard-grid {
        display: grid;
        grid-template-columns: 1.2fr 1.3fr 1fr;
        gap: 24px;
    }

    .dashboard-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        margin-bottom: 24px;
        transition: all 0.3s;
    }

    .dashboard-card:hover {
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    }

    .card-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
    }

    .header-icon-group {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .header-icon-group i {
        color: var(--primary);
        font-size: 1.25rem;
    }

    .header-icon-group h3 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--dark);
    }

    .header-action {
        display: flex;
        align-items: center;
    }

    .view-more-link {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.85rem;
        transition: all 0.2s;
    }

    .view-more-link:hover {
        opacity: 0.8;
    }

    .card-body {
        padding: 24px;
    }

    .card-body > :first-child {
        margin-top: 0;
    }

    .dashboard-card.slide-up {
        display: flex;
        flex-direction: column;
    }

    .view-more-link {
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.85rem;
        position: relative;
        overflow: hidden;
        display: inline-block;
    }

    .view-more-link::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 2px;
        bottom: -2px;
        left: 0;
        background: linear-gradient(90deg, transparent, var(--primary), transparent);
        transition: all 0.3s;
    }

    .view-more-link:hover::after {
        transform: translateX(0);
    }

    .lesson-item {
        background: linear-gradient(135deg, #f5f5f7 0%, #efefef 100%);
        padding: 14px;
        border-radius: 10px;
        border-left: 4px solid #5e5ce6;
        display: flex;
        gap: 14px;
        align-items: flex-start;
        transition: all 0.3s;
    }

    .lesson-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(94, 92, 230, 0.1);
    }

    .grades-stack {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 0;
    }

    .grade-item-modern {
        display: flex;
        gap: 14px;
        align-items: center;
        padding: 16px;
        background: var(--background);
        border-radius: 12px;
        transition: all 0.3s;
        justify-content: space-between;
    }

    .grade-item-modern:hover {
        transform: translateX(4px);
        background: white;
        box-shadow: 0 4px 12px rgba(94, 92, 230, 0.1);
    }

    .grade-icon-wrapper {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(94, 92, 230, 0.15), rgba(94, 92, 230, 0.05));
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .grade-info {
        flex: 1;
        min-width: 0;
    }

    .grade-course {
        font-weight: 700;
        font-size: 0.9rem;
        color: var(--dark);
        margin-bottom: 4px;
    }

    .grade-date {
        font-size: 0.75rem;
        color: var(--gray);
    }

    .grade-badge {
        display: flex;
        gap: 6px;
        align-items: center;
        padding: 8px 14px;
        border-radius: 10px;
        font-weight: 700;
        background: rgba(94, 92, 230, 0.08);
        color: var(--primary);
        flex-shrink: 0;
    }

    .grade-letter {
        font-size: 1rem;
    }

    .grade-score {
        font-size: 0.75rem;
        opacity: 0.8;
    }

    .attendance-stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 24px;
        margin-top: 0;
    }

    .stat-widget {
        display: flex;
        flex-direction: row;
        gap: 12px;
        padding: 20px;
        background: var(--background);
        border-radius: 12px;
        transition: all 0.3s;
        border-left: 4px solid transparent;
        align-items: center;
        text-align: left;
    }

    .stat-widget.attendance-present {
        border-left-color: var(--success);
    }

    .stat-widget.attendance-absent {
        border-left-color: var(--danger);
    }

    .stat-widget:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }

    .stat-widget-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        flex-shrink: 0;
    }

    .stat-widget.attendance-present .stat-widget-icon {
        background: rgba(52, 199, 89, 0.15);
        color: var(--success);
    }

    .stat-widget.attendance-absent .stat-widget-icon {
        background: rgba(255, 59, 48, 0.15);
        color: var(--danger);
    }

    .stat-widget-content {
        flex: 1;
    }

    .stat-widget-label {
        color: var(--gray);
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
    }

    .stat-widget-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--dark);
        line-height: 1;
    }

    .attendance-bar-section {
        margin-top: 24px;
    }

    .attendance-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .percentage-value {
        color: var(--primary);
        font-size: 1.2rem;
    }

    .progress-bar-animated {
        height: 8px;
        background: var(--border);
        border-radius: 10px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), #7c3aed);
        border-radius: 10px;
        animation: growWidth 1.2s ease-out;
    }

    @@keyframes growWidth {
        from {
            width: 0;
        }
    }

    .activity-feed {
        padding: 0;
    }

    .activity-timeline {
        display: flex;
        flex-direction: column;
    }

    .activity-entry {
        display: flex;
        gap: 16px;
        padding: 16px 24px;
        border-bottom: 1px solid var(--border);
        align-items: center;
        transition: all 0.2s;
    }

    .activity-entry:last-child {
        border-bottom: none;
    }

    .activity-entry:hover {
        background: rgba(94, 92, 230, 0.02);
    }

    .activity-status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        flex-shrink: 0;
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
    }

    .activity-status-dot.present {
        background: var(--success);
    }

    .activity-status-dot.absent {
        background: var(--danger);
    }

    .activity-status-dot.late {
        background: var(--warning);
    }

    .activity-text {
        flex: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .activity-action {
        font-weight: 600;
        color: var(--dark);
        font-size: 0.9rem;
    }

    .activity-time {
        font-size: 0.75rem;
        color: var(--gray);
    }

    .members-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 0;
    }

    .member-card {
        display: flex;
        gap: 12px;
        align-items: center;
        padding: 14px 16px;
        background: var(--background);
        border-radius: 10px;
        transition: all 0.3s;
        border: 1px solid transparent;
    }

    .member-card:hover {
        background: white;
        border-color: rgba(94, 92, 230, 0.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        transform: translateX(4px);
    }

    .member-avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        flex-shrink: 0;
        object-fit: cover;
        display: block;
    }

    .member-info {
        flex: 1;
        min-width: 0;
    }

    .member-name {
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--dark);
        margin-bottom: 2px;
    }

    .member-id {
        font-size: 0.75rem;
        color: var(--gray);
    }

    .announcements-list {
        padding: 0;
    }

    .announcement-card {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 16px 24px;
        border-bottom: 1px solid var(--border);
        transition: all 0.2s;
    }

    .announcement-card:last-child {
        border-bottom: none;
    }

    .announcement-card:hover {
        background: rgba(94, 92, 230, 0.02);
    }

    .announcement-data {
        flex: 1;
    }

    .announcement-title {
        font-weight: 700;
        font-size: 0.9rem;
        color: var(--dark);
        margin-bottom: 4px;
    }

    .announcement-excerpt {
        font-size: 0.8rem;
        color: var(--gray);
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .announcement-footer {
        display: flex;
        gap: 8px;
        font-size: 0.75rem;
        color: var(--gray);
    }

    .empty-placeholder {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray);
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray);
    }

    @@media (max-width: 1400px) {
        .student-dashboard-grid {
            grid-template-columns: 1fr 1fr;
        }

        .dashboard-right {
            grid-column: 1 / -1;
        }
    }

    @@media (max-width: 992px) {
        .status-cards-grid {
            grid-template-columns: 1fr;
        }

        .student-dashboard-grid {
            grid-template-columns: 1fr;
        }
    }

    @@media (max-width: 576px) {
        .attendance-stats-grid {
            grid-template-columns: 1fr;
        }

        .calendar-legend {
            flex-direction: column;
            gap: 12px;
        }
    }
</style>

<script>
    const studentLessons = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
        (object)(Model.UpcomingLessons != null
            ? Model.UpcomingLessons.GroupBy(l => l.LessonDate.Date.ToString("yyyy-MM-dd"))
                .ToDictionary(g => g.Key, g => g.Select(x => new { x.LessonId, x.Title, x.Location }).ToList())
            : new Dictionary<string, object>())
    ));

    let currentDate = new Date();

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        const monthYear = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        document.getElementById('monthYear').textContent = monthYear;

        const calendarDates = document.getElementById('calendarDates');
        calendarDates.innerHTML = '';

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysInPrevMonth = new Date(year, month, 0).getDate();

        for (let i = firstDay - 1; i >= 0; i--) {
            const dateEl = document.createElement('div');
            dateEl.className = 'calendar-date empty';
            dateEl.textContent = daysInPrevMonth - i;
            calendarDates.appendChild(dateEl);
        }

        const today = new Date();
        for (let day = 1; day <= daysInMonth; day++) {
            const dateEl = document.createElement('div');
            const fullDate = new Date(year, month, day);
            const dateStr = fullDate.toISOString().split('T')[0];

            dateEl.className = 'calendar-date';
            dateEl.textContent = day;

            if (fullDate.toDateString() === today.toDateString()) {
                dateEl.classList.add('today');
            }

            if (studentLessons && studentLessons[dateStr] && studentLessons[dateStr].length > 0) {
                dateEl.classList.add('has-sessions');
            }

            calendarDates.appendChild(dateEl);
        }

        const totalCells = calendarDates.children.length;
        const remainingCells = 42 - totalCells;
        for (let day = 1; day <= remainingCells; day++) {
            const dateEl = document.createElement('div');
            dateEl.className = 'calendar-date empty';
            dateEl.textContent = day;
            calendarDates.appendChild(dateEl);
        }
    }

    document.getElementById('prevMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    });

    renderCalendar();
</script>
