@page
@using Microsoft.AspNetCore.Authorization
@using SmartCampus.Web.Pages.Shared
@attribute [Authorize(Roles = "Admin")]
@model SmartCampus.Web.Pages.Courses.IndexModel
@{
    ViewData["Title"] = "Courses";
    var canCreate = User.IsInRole("Admin");
    var canEdit = User.IsInRole("Admin");
    var canDelete = User.IsInRole("Admin");

    var pageHeader = new PageHeaderModel
    {
        Title = "Courses",
        Subtitle = "Manage your courses and learning materials",
        IconClass = "fas fa-book",
        IconColor = "#0066ff",
        GradientStart = "rgba(0, 102, 255, 0.05)",
        GradientEnd = "rgba(94, 92, 230, 0.05)",
        BorderColor = "rgba(0, 102, 255, 0.1)",
        Actions = canCreate ? new()
        {
            new PageHeaderAction
            {
                Label = "New Course",
                Url = Url.Page("Create"),
                CssClass = "btn-primary",
                IconClass = "fas fa-plus"
            }
        } : new()
    };
}

<partial name="_PageHeader" model="pageHeader" />

<div class="row g-4">
    @if (Model.Courses != null && Model.Courses.Count > 0)
    {
        @foreach (var course in Model.Courses)
        {
            <div class="col-lg-4 col-md-6">
                <a asp-page="Details" asp-route-id="@course.Id" style="text-decoration: none; color: inherit;">
                    <div class="card" style="border: 1px solid #e5e5ea; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; height: 100%; overflow: hidden;">
                        
                        <div style="background: linear-gradient(135deg, #0066ff 0%, #5e5ce6 100%); padding: 20px; color: white; display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h5 style="font-size: 0.875rem; font-weight: 500; opacity: 0.9; margin-bottom: 4px;">
                                    @course.Code
                                </h5>
                                <h4 style="font-size: 1.125rem; font-weight: 700; margin: 0;">
                                    @course.Title
                                </h4>
                            </div>
                            <div style="font-size: 1.5rem; opacity: 0.8;">
                                <i class="fas fa-book-open"></i>
                            </div>
                        </div>

                        
                        <div class="card-body">
                            <p style="color: #636366; font-size: 0.875rem; margin-bottom: 12px;">
                                <i class="fas fa-user-tie me-2" style="color: #0066ff;"></i>
                                @course.TeacherName
                            </p>
                            <p style="color: #636366; font-size: 0.875rem; margin-bottom: 16px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                @course.Description
                            </p>

                            
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                @if (course.IsActive == true)
                                {
                                    <span style="display: inline-block; background: rgba(52, 199, 89, 0.1); color: #34c759; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">
                                        Active
                                    </span>
                                }
                                else
                                {
                                    <span style="display: inline-block; background: rgba(255, 149, 0, 0.1); color: #ff9500; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">
                                        Inactive
                                    </span>
                                }
                                <span style="display: inline-block; background: rgba(0, 102, 255, 0.1); color: #0066ff; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">
                                    @course.Credits Credits
                                </span>
                            </div>
                        </div>

                        
                        <div style="padding: 12px 16px; border-top: 1px solid #e5e5ea; display: flex; justify-content: space-between; align-items: center; background: #f5f5f7;">
                            <small style="color: #a1a1a6;">
                                <i class="fas fa-book me-1"></i>
                                @(course.Semester ?? "N/A")
                            </small>
                            <div style="display: flex; gap: 8px;">
                                
                                @await Html.PartialAsync("_ActionButtons", new { CanView = true, CanEdit = canEdit, CanDelete = canDelete, ViewUrl = Url.Page("Details", new { id = course.Id }), EditUrl = Url.Page("Edit", new { id = course.Id }), DeleteUrl = Url.Page("Index", new { handler = "Delete", id = course.Id }) })
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        }
    }
    else
    {
        <div class="col-12" style="padding: 40px; text-align: center; color: #a1a1a6;">
            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>No courses found. Create the first course.</p>
        </div>
    }
</div>
