@page
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin,Teacher")]
@model SmartCampus.Web.Pages.Students.IndexModel
@{
    ViewData["Title"] = "Students";
    var canCreate = User.IsInRole("Admin");
    var canEdit = User.IsInRole("Admin");
    var canDelete = User.IsInRole("Admin");
}


<div style="background: linear-gradient(135deg, rgba(52, 199, 89, 0.05) 0%, rgba(0, 102, 255, 0.05) 100%); border-radius: 16px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(52, 199, 89, 0.1);">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 style="font-size: 2rem; font-weight: 700; color: #1d1d1f; margin-bottom: 8px;">
                <i class="fas fa-user-graduate me-2" style="color: #34c759;"></i>Students
            </h1>
            <p style="color: #636366; margin-bottom: 0; font-size: 0.95rem;">
                <i class="fas fa-users me-1"></i>
                Manage all students and their academic records
            </p>
        </div>
        @if (canCreate)
        {
            <a asp-page="Create" class="btn btn-success" style="display:inline-flex; align-items:center; gap:8px;">
                <i class="fas fa-plus"></i> Add Student
            </a>
        }
    </div>
</div>


<div class="row mb-4">
    <div class="col-lg-6">
        <form method="get" class="d-flex gap-2">
            <div style="flex: 1;">
                <input type="text" name="searchTerm" placeholder="Search by name or email..." class="form-control" 
                       value="@Model.SearchTerm"
                       style="border: 1.5px solid #e5e5ea; border-radius: 10px; padding: 10px 14px;" />
            </div>
            <button type="submit" class="btn btn-primary" style="border-radius: 10px; padding: 10px 20px; background: #34c759; border: none;">
                <i class="fas fa-search"></i>
            </button>
        </form>
    </div>
    <div class="col-lg-6">
        <div class="d-flex gap-2 justify-content-end">
            <button class="btn btn-outline-secondary" style="border-radius: 10px; padding: 10px 20px;">
                <i class="fas fa-download me-2"></i>Export
            </button>
            <a asp-page="Index" class="btn btn-outline-secondary" style="border-radius: 10px; padding: 10px 20px;">
                <i class="fas fa-filter me-2"></i>Clear Filter
            </a>
        </div>
    </div>
</div>


<div class="card" style="border: 1px solid #e5e5ea; overflow: hidden;">
    @if (Model.Students != null && Model.Students.Count > 0)
    {
        <div style="overflow-x: auto;">
            <table class="table table-hover" style="margin-bottom: 0;">
                <thead style="background: #f5f5f7; border-bottom: 2px solid #e5e5ea;">
                    <tr>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Student</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Email</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Enrollment Year</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Phone</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Status</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var student in Model.Students)
                    {
                        <tr style="border-bottom: 1px solid #e5e5ea;">
                            <td style="padding: 16px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <img src="@(string.IsNullOrEmpty(User.FindFirst("ProfilePhoto")?.Value) ? $"https://ui-avatars.com/api/?name={System.Net.WebUtility.UrlEncode(student.FullName ?? "User")}&background=0066ff&color=fff&size=36&bold=true" : User.FindFirst("ProfilePhoto")?.Value)"
                                         alt="@(student.FullName ?? "Student")"
                                         style="width: 40px; height: 40px; border-radius: 50%; display: block; object-fit: cover;">
                                    <div>
                                        <p style="font-weight: 600; color: #1d1d1f; margin: 0; font-size: 0.875rem;">@student.FullName</p>
                                        <small style="color: #a1a1a6;">ID: @student.Id</small>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 16px; color: #636366; font-size: 0.875rem;">@student.Email</td>
                            <td style="padding: 16px; color: #636366; font-size: 0.875rem;">@student.EnrollmentYear</td>
                            <td style="padding: 16px; color: #636366; font-size: 0.875rem;">@student.PhoneNumber</td>
                            <td style="padding: 16px;">
                                @if (student.IsActive == true)
                                {
                                    <span style="display: inline-block; background: rgba(52, 199, 89, 0.1); color: #34c759; padding: 4px 10px; border-radius: 6px; font-weight: 600; font-size: 0.75rem;">
                                        Active
                                    </span>
                                }
                                else
                                {
                                    <span style="display: inline-block; background: rgba(255, 149, 0, 0.1); color: #ff9500; padding: 4px 10px; border-radius: 6px; font-weight: 600; font-size: 0.75rem;">
                                        Inactive
                                    </span>
                                }
                            </td>
                            <td style="padding: 16px;">
                                <div style="display: flex; gap: 8px;">
                                    @await Html.PartialAsync("_ActionButtons", new { CanView = true, CanEdit = canEdit, CanDelete = canDelete, ViewUrl = Url.Page("Details", new { id = student.Id }), EditUrl = Url.Page("Edit", new { id = student.Id }), DeleteUrl = Url.Page("Index", new { handler = "Delete", id = student.Id }), EntityId = student.Id })
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div style="padding: 40px; text-align: center; color: #a1a1a6;">
            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
            <p>No students found. @(string.IsNullOrEmpty(Model.SearchTerm) ? "Create the first student." : "Try adjusting your search.")</p>
        </div>
    }
</div>


<nav aria-label="Page navigation" style="margin-top: 30px;">
    <ul class="pagination justify-content-center" style="gap: 4px;">
        <li class="page-item"><a class="page-link" href="#" style="color: #0066ff; border: 1px solid #e5e5ea; border-radius: 8px; padding: 8px 12px;"><i class="fas fa-chevron-left"></i></a></li>
        <li class="page-item"><a class="page-link active" href="#" style="background: #0066ff; border: 1px solid #0066ff; color: white; border-radius: 8px; padding: 8px 12px;">1</a></li>
        <li class="page-item"><a class="page-link" href="#" style="color: #0066ff; border: 1px solid #e5e5ea; border-radius: 8px; padding: 8px 12px;">2</a></li>
        <li class="page-item"><a class="page-link" href="#" style="color: #0066ff; border: 1px solid #e5e5ea; border-radius: 8px; padding: 8px 12px;">3</a></li>
        <li class="page-item"><a class="page-link" href="#" style="color: #0066ff; border: 1px solid #e5e5ea; border-radius: 8px; padding: 8px 12px;"><i class="fas fa-chevron-right"></i></a></li>
    </ul>
</nav>
