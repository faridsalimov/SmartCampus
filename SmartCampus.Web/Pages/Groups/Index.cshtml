@page
@using Microsoft.AspNetCore.Authorization
@using SmartCampus.Web.Pages.Shared
@attribute [Authorize(Roles = "Admin,Teacher")]
@model SmartCampus.Web.Pages.Groups.IndexModel
@{
    ViewData["Title"] = "Groups";
    var canCreate = User.IsInRole("Admin");
    var canEdit = User.IsInRole("Admin");
    var canDelete = User.IsInRole("Admin");

    var pageHeader = new PageHeaderModel
    {
        Title = "Study Groups",
        Subtitle = "Manage and collaborate with study groups",
        IconClass = "fas fa-users",
        IconColor = "#5e5ce6",
        GradientStart = "rgba(94, 92, 230, 0.05)",
        GradientEnd = "rgba(0, 102, 255, 0.05)",
        BorderColor = "rgba(94, 92, 230, 0.1)",
        Actions = canCreate ? new()
        {
            new PageHeaderAction
            {
                Label = "Create Group",
                Url = Url.Page("Create"),
                CssClass = "btn-secondary",
                IconClass = "fas fa-plus"
            }
        } : new()
    };
}

<partial name="_PageHeader" model="pageHeader" />

@if (Model.Groups?.Count > 0)
{
    <div class="card" style="border: 1px solid #e5e5ea; overflow: hidden;">
        <div style="overflow-x: auto;">
            <table class="table table-hover" style="margin-bottom: 0;">
                <thead style="background: #f5f5f7; border-bottom: 2px solid #e5e5ea;">
                    <tr>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Group Name</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Code</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Members</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Academic Year</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var group in Model.Groups)
                    {
                        <tr style="border-bottom: 1px solid #e5e5ea; transition: background 0.2s ease;">
                            <td style="padding: 16px; color: #1d1d1f;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #5e5ce6, #0066ff); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.875rem;">
                                        @group.GroupName.First()
                                    </div>
                                    <span>@group.GroupName</span>
                                </div>
                            </td>
                            <td style="padding: 16px;">
                                <span style="display: inline-block; background: rgba(94, 92, 230, 0.1); color: #5e5ce6; padding: 4px 12px; border-radius: 6px; font-weight: 600; font-size: 0.875rem;">
                                    @group.GroupCode
                                </span>
                            </td>
                            <td style="padding: 16px; color: #1d1d1f;">
                                <span style="font-weight: 600;">@group.StudentCount</span> members
                            </td>
                            <td style="padding: 16px; color: #636366;">@group.AcademicYear</td>
                            <td style="padding: 16px;">
                                <div style="display: flex; gap: 8px;">
                                    @await Html.PartialAsync("_ActionButtons", new { CanView = true, CanEdit = canEdit, CanDelete = canDelete, ViewUrl = Url.Page("Details", new { id = group.Id }), EditUrl = Url.Page("Edit", new { id = group.Id }), DeleteUrl = Url.Page("Index", new { handler = "Delete", id = group.Id }), EntityId = group.Id })
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <div style="background: linear-gradient(135deg, rgba(94, 92, 230, 0.05) 0%, rgba(5, 142, 232, 0.05) 100%); border: 1px solid rgba(94, 92, 230, 0.1); border-radius: 12px; padding: 40px; text-align: center;">
        <div style="font-size: 3rem; color: #5e5ce6; opacity: 0.3; margin-bottom: 16px;">
            <i class="fas fa-inbox"></i>
        </div>
        <h4 style="color: #1d1d1f; font-weight: 600; margin-bottom: 8px;">No Groups Found</h4>
        <p style="color: #636366; margin-bottom: 0;">Create your first study group to get started.</p>
    </div>
}
