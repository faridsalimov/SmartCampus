@page
@using Microsoft.AspNetCore.Authorization
@using SmartCampus.Web.Pages.Shared
@attribute [Authorize(Roles = "Student")]
@model SmartCampus.Web.Pages.Attendance.IndexModel
@{
    ViewData["Title"] = "Attendance";

    var pageHeader = new PageHeaderModel
    {
        Title = "Attendance",
        Subtitle = "Track your class attendance and participation",
        IconClass = "fas fa-clipboard-check",
        IconColor = "#34c759",
        GradientStart = "rgba(52, 199, 89, 0.05)",
        GradientEnd = "rgba(94, 92, 230, 0.05)",
        BorderColor = "rgba(52, 199, 89, 0.1)",
    };
}

<partial name="_PageHeader" model="pageHeader" />


<div class="row g-3 mb-4">
    <div class="col-md-6 col-lg-4">
        <div class="card" style="border: 1px solid #e5e5ea; background: linear-gradient(135deg, rgba(52, 199, 89, 0.05) 0%, rgba(52, 199, 89, 0.02) 100%);">
            <div class="card-body">
                <p style="font-size: 0.875rem; color: #636366; font-weight: 500; margin-bottom: 8px;">
                    <i class="fas fa-check me-2" style="color: #34c759;"></i>Present
                </p>
                <h3 style="font-size: 1.75rem; font-weight: 700; color: #34c759; margin: 0;">@(Model.AttendanceRecords?.Count(a => a.Status == "Present") ?? 0)</h3>
                <small style="color: #a1a1a6; display: block; margin-top: 8px;">@(Model.AttendanceRecords?.Count() > 0 ? Math.Round((decimal)Model.AttendanceRecords.Count(a => a.Status == "Present") / Model.AttendanceRecords.Count() * 100, 1) : 0)% attendance rate</small>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-4">
        <div class="card" style="border: 1px solid #e5e5ea; background: linear-gradient(135deg, rgba(255, 149, 0, 0.05) 0%, rgba(255, 149, 0, 0.02) 100%);">
            <div class="card-body">
                <p style="font-size: 0.875rem; color: #636366; font-weight: 500; margin-bottom: 8px;">
                    <i class="fas fa-times me-2" style="color: #ff9500;"></i>Absent
                </p>
                <h3 style="font-size: 1.75rem; font-weight: 700; color: #ff9500; margin: 0;">@(Model.AttendanceRecords?.Count(a => a.Status == "Absent") ?? 0)</h3>
                <small style="color: #a1a1a6; display: block; margin-top: 8px;">@(Model.AttendanceRecords?.Count() > 0 ? Math.Round((decimal)Model.AttendanceRecords.Count(a => a.Status == "Absent") / Model.AttendanceRecords.Count() * 100, 1) : 0)% absence rate</small>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-4">
        <div class="card" style="border: 1px solid #e5e5ea; background: linear-gradient(135deg, rgba(255, 59, 48, 0.05) 0%, rgba(255, 59, 48, 0.02) 100%);">
            <div class="card-body">
                <p style="font-size: 0.875rem; color: #636366; font-weight: 500; margin-bottom: 8px;">
                    <i class="fas fa-circle-info me-2" style="color: #ff3b30;"></i>Late
                </p>
                <h3 style="font-size: 1.75rem; font-weight: 700; color: #ff3b30; margin: 0;">@(Model.AttendanceRecords?.Count(a => a.Status == "Late") ?? 0)</h3>
                <small style="color: #a1a1a6; display: block; margin-top: 8px;">@(Model.AttendanceRecords?.Count() > 0 ? Math.Round((decimal)Model.AttendanceRecords.Count(a => a.Status == "Late") / Model.AttendanceRecords.Count() * 100, 1) : 0)% late arrivals</small>
            </div>
        </div>
    </div>
</div>


<div class="card mb-4" style="border: 1px solid #e5e5ea;">
    <div class="card-body">
        <h5 style="font-weight: 600; color: #1d1d1f; margin-bottom: 20px;">
            <i class="fas fa-chart-pie me-2" style="color: #0066ff;"></i>Summary
        </h5>
        
        
        <div style="display: grid; gap: 16px;">
            <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="font-weight: 600; color: #1d1d1f;">Total Records</span>
                    <span style="color: #0066ff; font-weight: 600;">@(Model.AttendanceRecords?.Count ?? 0)</span>
                </div>
            </div>
            <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="font-weight: 600; color: #1d1d1f;">Attendance Rate</span>
                    <span style="color: #34c759; font-weight: 600;">@(Model.AttendanceRecords?.Count() > 0 ? Math.Round((decimal)Model.AttendanceRecords.Count(a => a.Status == "Present") / Model.AttendanceRecords.Count() * 100, 1) : 0)%</span>
                </div>
                <div style="width: 100%; height: 8px; background: #e5e5ea; border-radius: 4px; overflow: hidden;">
                    <div style="width: @(Model.AttendanceRecords?.Count() > 0 ? Math.Round((decimal)Model.AttendanceRecords.Count(a => a.Status == "Present") / Model.AttendanceRecords.Count() * 100, 1) : 0)%; height: 100%; background: linear-gradient(90deg, #34c759, #5dd98f);"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="card" style="border: 1px solid #e5e5ea; overflow: hidden;">
    <div style="padding: 16px; border-bottom: 1px solid #e5e5ea; background: #f5f5f7;">
        <h5 style="font-weight: 600; color: #1d1d1f; margin: 0;">
            <i class="fas fa-calendar me-2" style="color: #34c759;"></i>Records
        </h5>
    </div>
    @if (Model.AttendanceRecords != null && Model.AttendanceRecords.Count > 0)
    {
        <div style="overflow-x: auto;">
            <table class="table table-hover" style="margin-bottom: 0;">
                <thead style="background: #f5f5f7; border-bottom: 2px solid #e5e5ea;">
                    <tr>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Teacher</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Lesson</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Status</th>
                        <th style="padding: 16px; font-weight: 600; color: #1d1d1f; font-size: 0.875rem;">Date</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var record in Model.AttendanceRecords.OrderByDescending(r => r.AttendanceDate))
                    {
                        <tr style="border-bottom: 1px solid #e5e5ea;">
                            <td style="padding: 16px; color: #1d1d1f;">@record.TeacherName</td>
                            <td style="padding: 16px; color: #1d1d1f;">@record.LessonTitle</td>
                            <td style="padding: 16px;">
                                @if (record.Status == "Present")
                                {
                                    <span style="display: inline-block; background: rgba(52, 199, 89, 0.1); color: #34c759; padding: 4px 12px; border-radius: 6px; font-weight: 600; font-size: 0.875rem;">
                                        <i class="fas fa-check me-1"></i>Present
                                    </span>
                                }
                                else if (record.Status == "Absent")
                                {
                                    <span style="display: inline-block; background: rgba(255, 59, 48, 0.1); color: #ff3b30; padding: 4px 12px; border-radius: 6px; font-weight: 600; font-size: 0.875rem;">
                                        <i class="fas fa-times me-1"></i>Absent
                                    </span>
                                }
                                else if (record.Status == "Late")
                                {
                                    <span style="display: inline-block; background: rgba(255, 149, 0, 0.1); color: #ff9500; padding: 4px 12px; border-radius: 6px; font-weight: 600; font-size: 0.875rem;">
                                        <i class="fas fa-clock me-1"></i>Late
                                    </span>
                                }
                                else
                                {
                                    <span style="display: inline-block; background: rgba(160, 160, 160, 0.1); color: #636366; padding: 4px 12px; border-radius: 6px; font-weight: 600; font-size: 0.875rem;">
                                        @record.Status
                                    </span>
                                }
                            </td>
                            <td style="padding: 16px; color: #636366;">@record.AttendanceDate.ToString("dd MMM yyyy")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div style="padding: 40px; text-align: center; color: #a1a1a6;">
            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>No attendance records found.</p>
        </div>
    }
</div>
